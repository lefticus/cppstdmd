%%--------------------------------------------------
%% simplified_macros.tex
%% Simplified macro definitions for Pandoc conversion
%%
%% This file replaces complex macro definitions from cplusplus-draft/source/macros.tex
%% with simpler forms that Pandoc can understand natively.
%% Used by the C++ standard converter to reduce Lua filter complexity.
%%
%% Strategy: Convert custom C++ standard macros to standard LaTeX commands
%% that Pandoc already knows how to handle (\texttt, \textit, etc.)
%%
%% ARCHITECTURAL DECISION: Prefer this file over Lua filters for:
%% - Pure typesetting commands (font styling, spacing, line breaking)
%% - Simple string substitutions (C++, NTBS, etc.)
%% - Commands appearing in BOTH BNF and code contexts
%%
%% WHY: One-line fixes work in ALL contexts (BNF, code, tables, text)
%% automatically, avoiding duplication across multiple Lua filters.
%%
%% Example: \itcorr was being stripped in multiple places. Moving it here
%% eliminated duplication and fixed bugs in one place.
%%--------------------------------------------------

%%--------------------------------------------------
%% Category A: Simple Text Substitutions
%%--------------------------------------------------
%% Remove line-breaking hints
\renewcommand{\-}{}           % Discretionary hyphen
\renewcommand{\linebreak}{}   % Line break hint
\renewcommand{\newline}{ }    % Strip line breaks - markdown doesn't support mid-table breaks
\renewcommand{\@}{}           % Sentence spacing control (LaTeX typography)
\renewcommand{\textnormal}[1]{#1}  % Strip text formatting wrapper (BNF grammars, code blocks)
\renewcommand{\textregistered}{Â®}  % Registered trademark symbol
\renewcommand{\Cpp}{C++}
\renewcommand{\CppIII}{C++03}
\renewcommand{\CppXI}{C++11}
\renewcommand{\CppXIV}{C++14}
\renewcommand{\CppXVII}{C++17}
\renewcommand{\CppXX}{C++20}
\renewcommand{\CppXXIII}{C++23}
\renewcommand{\CppXXVI}{C++26}
\renewcommand{\IsoC}{ISO/IEC 9899:2018 (C)}
\renewcommand{\IsoPosix}{IEEE 1003.1-2017 (POSIX)}
\renewcommand{\IsoFloatUndated}{ISO/IEC 60559}
\renewcommand{\xrefc}[1]{See also: ISO C #1}
\renewcommand{\cv}{cv}
\renewcommand{\cvqual}[1]{\textit{#1}}
\renewcommand{\ntbs}{NTBS}
\renewcommand{\ntmbs}{NTMBS}
%% \caret - Pandoc can't handle \string^ properly, needs Lua filter
\renewcommand{\atsign}{@}
%% \unun - Pandoc can't handle \string_ properly, needs Lua filter
\renewcommand{\brk}{}
\renewcommand{\tilde}{\textasciitilde}
%% Shift operators (n3337/n4140 style - later versions use \terminal{<<} etc.)
%% NO argument: \shl -> <<, orphaned {} stripped by cpp-grammar.lua line 246
\renewcommand{\shl}{<<}
\renewcommand{\shr}{>>}
%% Circumflex/XOR (n3337 style) - \^{} becomes ^ via \caret{}
\renewcommand{\^}[1]{\caret{}}
%% Anonymous namespace identifier (n3337 style) - has trailing space in original
\renewcommand{\uniquens}{\textit{unique} }

%%--------------------------------------------------
%% Category B: Code Formatting
%%--------------------------------------------------
%% \tcode{} - contains nested macros, handled in Lua
%% \ctype{} - nested in \tcode{}, handled in Lua
%% \terminal{} - needs special handling in cpp-grammar.lua for BNF terminals
\renewcommand{\keyword}[1]{\texttt{#1}}
\renewcommand{\libheader}[1]{\texttt{<#1>}}
\renewcommand{\libheaderdef}[1]{\texttt{<#1>}}
\renewcommand{\libheaderref}[1]{\texttt{<#1>}}
\renewcommand{\libnoheader}[1]{\texttt{<#1>}}
\renewcommand{\libconcept}[1]{\texttt{#1}}
\renewcommand{\exposconcept}[1]{\texttt{#1}}
\renewcommand{\libglobal}[1]{\texttt{#1}}
\renewcommand{\deflibconcept}[1]{\texttt{#1}}

%%--------------------------------------------------
%% Category C: Emphasis Formatting
%%--------------------------------------------------
%% \grammarterm{} - context-dependent (BNF vs text), handled in Lua
%% \exposid{}, \exposidnc{}, \exposconceptnc{} - need code+italic, handled in Lua
\renewcommand{\seebelownc}[1]{\textit{see below}}
%% \placeholder{}, \placeholdernc{} - context-dependent, handled in Lua
\renewcommand{\defn}[1]{\textit{#1}}
\renewcommand{\defnx}[2]{\textit{#1}}
\renewcommand{\defnadjx}[3]{\textit{#1 #2}}
\renewcommand{\term}[1]{\textit{#1}}
\renewcommand{\techterm}[1]{\textit{#1}}
\renewcommand{\oldconcept}[1]{\textit{Cpp17#1}}
\renewcommand{\doccite}[1]{\textit{#1}}
\renewcommand{\exposconceptx}[2]{\texttt{\textit{#1}}}

%%--------------------------------------------------
%% Category D: Library Specifications
%%--------------------------------------------------
\renewcommand{\seebelow}{\textit{see below}}
\renewcommand{\unspec}{\textit{unspecified}}
\renewcommand{\unspecnc}{\textit{unspecified}}
\renewcommand{\expos}{\textit{exposition only}}
\renewcommand{\impldef}[1]{\textit{implementation-defined}}
\renewcommand{\impldefplain}[1]{\textit{implementation-defined}}
\renewcommand{\notdef}{\textit{not defined}}
\renewcommand{\impdef}{\textit{implementation-defined}}

%%--------------------------------------------------
%% Category E: Fundesc Labels
%%--------------------------------------------------
\renewcommand{\expects}{\textit{Preconditions:} }
\renewcommand{\requires}{\textit{Requires:} }
\renewcommand{\constraints}{\textit{Constraints:} }
\renewcommand{\effects}{\textit{Effects:} }
\renewcommand{\ensures}{\textit{Ensures:} }
\renewcommand{\returns}{\textit{Returns:} }
\renewcommand{\result}{\textit{Result:} }
\renewcommand{\complexity}{\textit{Complexity:} }
\renewcommand{\remarks}{\textit{Remarks:} }
\renewcommand{\throws}{\textit{Throws:} }
\renewcommand{\errors}{\textit{Error conditions:} }
\renewcommand{\mandates}{\textit{Mandates:} }
\renewcommand{\recommended}{\textit{Recommended practice:} }
\renewcommand{\required}{\textit{Required behavior:} }
\renewcommand{\default}{\textit{Default behavior:} }
\renewcommand{\sync}{\textit{Synchronization:} }
\renewcommand{\replaceable}{\textit{Replaceable:} }
\renewcommand{\returntype}{\textit{Return type:} }
\renewcommand{\cvalue}{\textit{Value:} }
\renewcommand{\templalias}{\textit{Alias template:} }
\renewcommand{\implimits}{\textit{Implementation limits:} }
\renewcommand{\postconditions}{\textit{Postconditions:} }
\renewcommand{\preconditions}{\textit{Preconditions:} }
\renewcommand{\realnote}{\textit{Note:} }
\renewcommand{\notes}{\textit{Remarks:} }
\renewcommand{\realnotes}{\textit{Notes:} }

%%--------------------------------------------------
%% Category F: Ranges
%% WHY: Square brackets wrapped in braces {[} {]} to escape them for Pandoc
%%--------------------------------------------------
\renewcommand{\range}[2]{{[}\texttt{#1}, \texttt{#2}{)}}
\renewcommand{\crange}[2]{{[}\texttt{#1}, \texttt{#2}{]}}
\renewcommand{\brange}[2]{{(}\texttt{#1}, \texttt{#2}{)}}
\renewcommand{\orange}[2]{{(}\texttt{#1}, \texttt{#2}{)}}
\renewcommand{\countedrange}[2]{\texttt{#1}+{[}0, \texttt{#2}{)}}

%%--------------------------------------------------
%% Category G: Change Descriptions
%%--------------------------------------------------
\renewcommand{\change}{\textbf{Change:} }
\renewcommand{\rationale}{\textbf{Rationale:} }
\renewcommand{\effect}{\textbf{Effect on original feature:} }

%%--------------------------------------------------
%% Category H: Special Formatting
%%--------------------------------------------------
%% \textbackslash - standard LaTeX command, no need to redefine
\renewcommand{\cppver}{202302L}
\renewcommand{\tablerefheader}[1]{\textbf{#1}}
%% \stage{} - handled in cpp-macros.lua for description list processing
\renewcommand{\columnline}{}

%%--------------------------------------------------
%% Category I: Simple Unwrapping
%%--------------------------------------------------
\renewcommand{\deflibconcept}[1]{#1}
\renewcommand{\uname}[1]{#1}
%% \colcol - context-dependent, handled in Lua
%% \mathrm{} - standard LaTeX math command, different meaning in math mode
%% \bigoh{} - needs special handling in cpp-itemdecl.lua

%%--------------------------------------------------
%% Category J: Additional Macros
%%--------------------------------------------------
\renewcommand{\descr}[1]{#1}
\renewcommand{\fmtgrammarterm}[1]{\textit{#1}}
\renewcommand{\UAX}[1]{UAX \##1}
%% \opt - NOT defined here because it would break BNF blocks
%% Handled in cpp-grammar.lua (BNF) and cpp-macros.lua (text)

%%--------------------------------------------------
%% Category K: Math Operators
%% WHY: Unicode subscripts don't exist for all letters, so these
%% operators are left as LaTeX for MathJax rendering
%%--------------------------------------------------
%% \leftshift{} and \rightshift - NOT simplified due to Unicode subscript limitations

%%--------------------------------------------------
%% Category L: Additional Code and Grammar Macros
%%--------------------------------------------------
\renewcommand{\libmacro}[1]{\texttt{#1}}
\renewcommand{\fmtnontermdef}[1]{\textit{#1}}
\renewcommand{\fakegrammarterm}[1]{\textit{#1}}
\renewcommand{\renontermdef}[1]{#1::}
\renewcommand{\defexposconceptnc}[1]{\textit{#1}}
\renewcommand{\state}[2]{#1\ensuremath{_{#2}}}

%%--------------------------------------------------
%% Category M: BNF Typography
%%--------------------------------------------------
\renewcommand{\BnfNontermshape}{}
\renewcommand{\itcorr}[1][]{}
\renewcommand{\locnontermdef}[1]{#1:}

%%--------------------------------------------------
%% Macros handled in Lua filters instead of here:
%%  - \tcode{}, \ctype{}, \grammarterm{}, \placeholder{}, \placeholdernc{}
%%  - \exposid{}, \exposidnc{}, \exposconceptnc{}
%%  - \stage{}, \colcol{}, \mathrm{}, \bigoh{}
%% WHY: These require context-dependent handling, nested macro support,
%% or special formatting that can't be done in simple LaTeX substitution
%%--------------------------------------------------

%%--------------------------------------------------
%% Category N: Annexes (Appendices)
%% WHY: \infannex and \normannex create chapter-level headings in LaTeX
%% for informative and normative annexes. We prepend @@ANNEX:type@@ marker so
%% cpp-sections.lua can detect the annex type and generate H1 headings with:
%% - Embedded anchors marked as annexes: <a data-annex="true" data-annex-type="...">
%% - Type designation in title: "Title (informative)" or "Title (normative)"
%% This allows the TOC generator to use letter numbering (A, B, C, etc.)
%% and include the informative/normative designation.
%%--------------------------------------------------
\renewcommand{\infannex}[2]{@@ANNEX:informative@@\rSec{0}[#1]{#2}}
\renewcommand{\normannex}[2]{@@ANNEX:normative@@\rSec{0}[#1]{#2}}

%%--------------------------------------------------
%% Category O: Figures (importgraphic)
%% WHY: \begin{importgraphic}{caption}{tag}{file} creates a figure with
%% \includegraphics. We convert to a marker that cpp-figures.lua can
%% process after notes/examples are parsed (preserving surrounding content).
%% Format: @@FIGURE:tag:file:caption@@
%% \fref{tag} creates inline figure references: "Figure [[fig:tag]]"
%% Links to anchors created by cpp-figures.lua
%%--------------------------------------------------
\renewenvironment{importgraphic}[3]{@@FIGURE:#2:#3:#1@@}{}
\renewcommand{\fref}[1]{Figure [[fig:#1]]}
